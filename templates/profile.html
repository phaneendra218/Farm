{% extends "base.html" %}

{% block content %}
<div class="profile-container">
    <h2>My Profile</h2>

    <div class="profile-section">
        <h3>Addresses</h3>
        {% if user.addresses %}
            {% for address in user.addresses %}
                <div class="address-section {{ 'default-address' if address.is_default else 'non-default-address' }}">
                    <p><strong>{{ address.address_type }}</strong></p>
                    <p>{{ address.address }}</p>
                    <form method="post" action="{{ url_for('profile') }}" style="display: inline-block;">
                        <input type="hidden" name="address_id" value="{{ address.id }}">
                        <input type="hidden" name="action" value="make_default">
                        <button type="submit" class="btn btn-secondary" {% if address.is_default %}disabled{% endif %}>
                            Make Default
                        </button>
                    </form>
                    <button class="btn btn-danger delete-address" data-id="{{ address.id }}">Delete</button>
                </div>
            {% endfor %}
        {% else %}
            <p>No addresses available.</p>
        {% endif %}
    </div>
</div>

<script>
    document.querySelectorAll('.delete-address').forEach(button => {
        button.addEventListener('click', function () {
            const addressId = this.getAttribute('data-id');
            if (confirm('Are you sure you want to delete this address?')) {
                fetch('{{ url_for("delete_address_by_id") }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        address_id: addressId,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);
                        window.location.reload();
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    });
</script>
{% endblock %}
