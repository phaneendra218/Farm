<!-- templates/checkout.html -->
{% extends "base.html" %}

{% block content %}
  <h1>Checkout</h1>
  
  <!-- Section: Delivery Address -->
  <div id="delivery-address-section">
    <h2>Confirm Delivery Address</h2>

    {% if addresses %}
      <ul>
        {% for address in addresses %}
          <li>
            <input 
              type="radio" 
              name="address_id" 
              value="{{ address.id }}" 
              {% if address.is_default %} checked {% endif %}
            >
            {{ address.address_type }}: {{ address.address }}
          </li>
        {% endfor %}
      </ul>
      <button id="confirm-address-button" class="btn btn-primary">Confirm Address</button>
    {% else %}
      <p>No addresses found. Please add an address to proceed.</p>
      <a href="{{ url_for('profile') }}" class="btn btn-success">+ Add New Address</a>
    {% endif %}
  </div>

  <!-- Section: Proceed to Payment -->
  <div id="payment-section" class="hidden">
    <form method="POST" action="{{ url_for('process_checkout') }}">
      <!-- Add form fields for payment details -->
      <button type="submit" class="btn btn-primary">Submit Order</button>
    </form>
  </div>

  <script>
    // JS to manage address selection and proceed to payment
    document.getElementById('confirm-address-button')?.addEventListener('click', () => {
      const selectedAddress = document.querySelector('input[name="address_id"]:checked');
      if (!selectedAddress) {
        alert('Please select a delivery address.');
        return;
      }
      
      // Mark payment section visible and focus on it
      document.getElementById('payment-section').classList.remove('hidden');
      window.scrollTo(0, document.getElementById('payment-section').offsetTop);
    });
  </script>
{% endblock %}
