{% extends "base.html" %}

{% block content %}
<h1>Checkout</h1>

<!-- If no addresses are available -->
{% if addresses|length == 0 %}
  <p>No delivery addresses found. Please add an address.</p>
  <button id="add-address-button" class="btn btn-primary">Add Address</button>
  <div id="add-address-popup" class="hidden">
    <iframe src="{{ url_for('profile') }}" frameborder="0" width="100%" height="400px"></iframe>
    <button id="close-popup" class="btn btn-danger">Close</button>
  </div>
{% else %}
  <form method="POST" action="{{ url_for('checkout') }}">
    <h3>Select Delivery Address</h3>
    {% for address in addresses %}
      <div>
        <input type="radio" name="address_id" value="{{ address.id }}" 
               {% if default_address and address.id == default_address.id %} checked {% endif %}>
        <label>{{ address.address_type }}: {{ address.address }}</label>
      </div>
    {% endfor %}
    <button type="submit" class="btn btn-success">Proceed to Payment</button>
  </form>
{% endif %}
{% endblock %}

<script>
document.addEventListener('DOMContentLoaded', function () {
  const addAddressButton = document.getElementById('add-address-button');
  const addAddressPopup = document.getElementById('add-address-popup');
  const closePopupButton = document.getElementById('close-popup');

  addAddressButton.addEventListener('click', function () {
    addAddressPopup.style.display = 'block';
  });

  closePopupButton.addEventListener('click', function () {
    addAddressPopup.style.display = 'none';
    location.reload(); // Reload page to fetch newly added address
  });
});
</script>
